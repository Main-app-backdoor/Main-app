name: Code Analysis

on:
  push:
  pull_request:

jobs:
  analyze_cpp:
    runs-on: ubuntu-22.04
    steps:
      - name: Check out code
        uses: actions/checkout@v3
      - name: Install Cppcheck
        run: sudo apt-get update && sudo apt-get install -y cppcheck
      - name: Run Cppcheck
        run: |
          find shared/ IOS/ -name "*.cpp" -o -name "*.cxx" -o -name "*.cc" | xargs cppcheck --enable=all --inconclusive --quiet --std=c++11 --language=c++ --force

  analyze_swift:
    runs-on: macos-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v3
      - name: Install SwiftLint
        run: brew install swiftlint
      - name: Run SwiftLint
        run: swiftlint lint shared/ IOS/

  analyze_infer:
    runs-on: ubuntu-22.04
    steps:
      - name: Check out code
        uses: actions/checkout@v3
      - name: Install Infer
        run: |
          sudo apt-get update
          sudo apt-get install -y infer
      - name: Run Infer
        run: infer run -- make